{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:center;">
    <div>
      <h3 class="title">Pembelian Bahan</h3>
      <p class="subtitle">Stok masuk & hutang usaha</p>
    </div>
    <a class="btn" href="{{ url_for('main.dashboard') }}">Kembali</a>
  </div>

  <hr class="sep">

  <form method="post">
    <div class="form-grid">
      <div class="col-3">
        <label>Tanggal</label>
        <input type="date" name="date">
      </div>

      <div class="col-3">
        <label>Supplier</label>
        <select name="supplier_id">
          <option value="">-</option>
          {% for s in suppliers %}
          <option value="{{ s.id }}">{{ s.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-3">
        <label>Bahan</label>
        <select name="item_id">
          {% for i in items %}
          <option value="{{ i.id }}">{{ i.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-3">
        <label>Qty</label>
        <input name="qty">
      </div>

      <div class="col-3">
        <label>Harga</label>
        <input name="price">
      </div>

      <div class="col-12">
        <label>Keterangan</label>
        <input name="memo">
      </div>
    </div>

    <div class="spacer"></div>
    <button class="btn btn-primary">Simpan Pembelian</button>
  </form>
</div>

<div class="spacer"></div>

<div class="card soft">
  <h4 class="title">Pembelian Terakhir</h4>
  <hr class="sep">
  <table>
    <tr>
      <th>Tanggal</th>
      <th>Supplier</th>
      <th>Total</th>
      <th>Memo</th>
    </tr>
    {% for p in purchases %}
    <tr>
      <td>{{ p.date.date() }}</td>
      <td>{{ p.supplier_name or "-" }}</td>
      <td>Rp {{ "{:,.0f}".format(p.total_amount) }}</td>
      <td>{{ p.memo or "" }}</td>
    </tr>
    <td class="row" style="gap:6px;">
       <a class="btn btn-ghost" href="{{ url_for('main.purchase_edit', purchase_id=p.id) }}">Edit</a>
      <form method="post" action="{{ url_for('main.purchase_delete', purchase_id=p.id) }}"
        onsubmit="return confirm('Hapus pembelian ini? Stok & jurnal akan dikembalikan.');">
    <button class="btn btn-danger" type="submit">Hapus</button>
    </form>
    </td>     
    {% endfor %}    
  </table>
</div>
{% endblock %}
