{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="row" style="justify-content: space-between; align-items:center;">
    <div>
      <h2 class="title">Detail Invoice</h2>
      <p class="subtitle"><b>{{ inv.invoice_no }}</b> ‚Ä¢ {{ inv.customer_name }}</p>
    </div>

    <div class="row" style="gap:8px;">
      <a class="btn" href="{{ url_for('main.sales_invoice_home') }}">‚¨ÖÔ∏è Kembali</a>

      <a
        class="btn btn-ghost"
        href="{{ url_for('main.export_sales_invoice_pdf', invoice_id=inv.id) }}"
        target="_blank"
        rel="noopener"
        title="Buka PDF di tab baru lalu download/save dari viewer"
      >
        üñ®Ô∏è Print / Save PDF
      </a>

      <a class="btn btn-primary" href="{{ url_for('main.ar_payment_home') }}">‚úÖ Input Pelunasan</a>
    </div>
  </div>
</div>

<div class="spacer"></div>

<div class="card soft">
  <div class="form-grid">
    <div class="col-4">
      <p class="subtitle">Tanggal</p>
      <p><b>{{ inv.date.date() }}</b></p>
    </div>

    <div class="col-4">
      <p class="subtitle">Status</p>
      <p><b>{{ (inv.status or "")|upper }}</b></p>
    </div>

    <div class="col-4">
      <p class="subtitle">Jurnal</p>
      {% if inv.journal_entry_id %}
        <p><a href="{{ url_for('main.journals_detail', entry_id=inv.journal_entry_id) }}">Lihat Jurnal</a></p>
      {% else %}
        <p class="muted">-</p>
      {% endif %}
    </div>

    <div class="col-6">
      <p class="subtitle">Akun Piutang</p>
      <p><b>{{ inv.ar_account_code }}</b> ‚Äî {{ inv.ar_account_name }}</p>
    </div>

    <div class="col-6">
      <p class="subtitle">Akun Penjualan</p>
      <p><b>{{ inv.revenue_account_code }}</b> ‚Äî {{ inv.revenue_account_name }}</p>
    </div>

    <div class="col-12">
      <p class="subtitle">Catatan</p>
      <p>{{ inv.notes or "-" }}</p>
    </div>
  </div>
</div>

<div class="spacer"></div>

<div class="card">
  <h3 class="title">Rincian</h3>
  <hr class="sep">

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Deskripsi</th>
          <th style="width:90px; text-align:right;">Qty</th>
          <th style="width:110px;">Satuan</th>
          <th style="width:150px; text-align:right;">Harga</th>
          <th style="width:160px; text-align:right;">Jumlah</th>
        </tr>
      </thead>

      <tbody>
        {% for ln in inv.lines %}
          <tr>
            <td>{{ ln.description }}</td>
            <td style="text-align:right;">{{ "{:,.2f}".format(ln.qty or 0) }}</td>
            <td>{{ ln.unit or "-" }}</td>
            <td style="text-align:right;">Rp {{ "{:,.0f}".format(ln.price or 0) }}</td>
            <td style="text-align:right;">Rp {{ "{:,.0f}".format(ln.amount or 0) }}</td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" class="muted">Tidak ada item.</td>
          </tr>
        {% endfor %}
      </tbody>

      <tfoot>
        <tr>
          <th colspan="4" style="text-align:right;">TOTAL</th>
          <th style="text-align:right;">Rp {{ "{:,.0f}".format(inv.total_amount or 0) }}</th>
        </tr>
        <tr>
          <th colspan="4" style="text-align:right;">TERBAYAR</th>
          <th style="text-align:right;">Rp {{ "{:,.0f}".format(inv.paid_amount or 0) }}</th>
        </tr>
        <tr>
          <th colspan="4" style="text-align:right;">SISA PIUTANG</th>
          <th style="text-align:right;">
            Rp {{ "{:,.0f}".format((inv.total_amount or 0) - (inv.paid_amount or 0)) }}
          </th>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

{% endblock %}
