{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="row" style="justify-content: space-between; align-items:center; gap:10px;">
    <div>
      <h3 class="title">Penjualan</h3>
      <p class="subtitle">Input penjualan & auto jurnal (Debit Kas/Bank/Piutang, Kredit Pendapatan)</p>
    </div>

    <div class="row" style="gap:10px;">
      <a class="btn btn-ghost" href="{{ url_for('main.ar_settlement_home') }}">
        ğŸ’³ Pelunasan Piutang
      </a>
      <a class="btn" href="{{ url_for('main.dashboard') }}">â¬…ï¸ Dashboard</a>
    </div>
  </div>

  <hr class="sep">

  <form method="post" class="form-grid">
    <div class="col-4">
      <label class="subtitle">Tanggal</label>
      <input class="input" type="date" name="date" value="{{ today }}" required>
    </div>

    <div class="col-8">
      <label class="subtitle">Nama Customer (opsional)</label>
      <input class="input" type="text" name="customer_name" placeholder="mis: Andi">
    </div>

    <div class="col-6">
      <label class="subtitle">Akun Debit (Kas/Bank/Piutang)</label>
      <select class="input" name="debit_account" required>
        <option value="">- pilih -</option>
        {% for a in debit_accounts %}
          <option value="{{ a.code }}">{{ a.code }} - {{ a.name }}</option>
        {% endfor %}
      </select>
      <p class="muted" style="margin-top:6px;">
        Jika pilih <b>Piutang</b> â†’ lunasinya lewat menu
        <a href="{{ url_for('main.ar_settlement_home') }}">Pelunasan Piutang</a>.
      </p>
    </div>

    <div class="col-6">
      <label class="subtitle">Akun Pendapatan (Kredit)</label>
      <select class="input" name="revenue_account" required>
        <option value="">- pilih -</option>
        {% for a in revenue_accounts %}
          <option value="{{ a.code }}">{{ a.code }} - {{ a.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-6">
      <label class="subtitle">Nominal</label>
      <input class="input" type="number" step="0.01" name="amount" placeholder="0" required>
    </div>

    <div class="col-6">
      <label class="subtitle">Catatan (opsional)</label>
      <input class="input" type="text" name="memo" placeholder="mis: jual paket A">
    </div>

    <div class="col-12 row" style="gap:10px;">
      <button class="btn btn-primary" type="submit">Simpan Penjualan</button>
      <a class="btn btn-ghost" href="{{ url_for('main.ar_settlement_home') }}">
        ğŸ’³ Input Pelunasan Piutang
      </a>
    </div>
  </form>
</div>

<div class="spacer"></div>

<div class="card">
  <div class="row" style="justify-content: space-between; align-items:center; gap:10px;">
    <h3 class="title">Riwayat Penjualan</h3>
    <a class="btn btn-ghost" href="{{ url_for('main.ar_settlement_home') }}">
      ğŸ’³ Ke Pelunasan Piutang
    </a>
  </div>
  <hr class="sep">

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Debit</th>
          <th>Kredit</th>
          <th style="text-align:right;">Nominal</th>
          <th>Catatan</th>
          <th style="width:180px;"></th>
        </tr>
      </thead>
      <tbody>
        {% for tx in sales %}
        <tr>
          <td>{{ tx.date.date() }}</td>
          <td>{{ tx.cash_account_code }} - {{ tx.cash_account_name }}</td>
          <td>{{ tx.counter_account_code }} - {{ tx.counter_account_name }}</td>
          <td style="text-align:right;">Rp {{ "{:,.0f}".format(tx.amount or 0) }}</td>
          <td>{{ tx.memo or "-" }}</td>
          <td style="text-align:right;">
            <a class="btn btn-ghost" href="{{ url_for('main.sales_edit', tx_id=tx.id) }}">Edit</a>
            <form method="post" action="{{ url_for('main.sales_delete', tx_id=tx.id) }}"
                  style="display:inline;" onsubmit="return confirm('Hapus transaksi penjualan ini?');">
              <button class="btn btn-danger" type="submit">Hapus</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="muted">Belum ada data penjualan.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
